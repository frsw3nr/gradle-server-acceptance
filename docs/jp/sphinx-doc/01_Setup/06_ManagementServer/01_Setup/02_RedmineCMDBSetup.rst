Redmine 設定
============

前節でインストールした Redmine を構成管理DBとしてカスタマイズします。

Redmineテーマ変更
-----------------

日本語表示の見易さを重視したテーマの「farend_basic」に変更します。

::

   cd ~/redmine/public/themes
   git clone https://github.com/farend/redmine_theme_farend_basic.git
   mv redmine_theme_farend_basic/ farend_basic

Webブラウザから、"http://サーバ/redmine" にアクセスします。
ユーザ/パスワードに admin/admin を入力して、管理者ユーザとして接続します

上部メニューから、管理、設定、表示、テーマで「farend_basic」に変更

Getconfig プラグインの追加
--------------------------

検査エビデンス用のテーブルをRedmineデータベースに作成し、Redmineリンク
から参照できるようにします。

GitHub からプラグインをダウンロードします。

::

   cd ~/redmine/plugins
   git clone https://github.com/frsw3nr/redmine_getconfig

プラグイン用ライブラリをインストールします。

::

   cd ~/redmine
   bundle install

Redmineデータベースにテーブルを作成します

::

   RAILS_ENV=production bundle exec bin/rake redmine:plugins:migrate

テーブルの文字コードの設定を utf8 から utf8mb4 に変更します。

::

   mysql -u root -p redmine < plugins/redmine_getconfig/docs/db_change_utf8_to_utf8mb4.sql

初期設定
--------

`Redmineを使い始めるための初期設定`_ を参考にして、日本語の利用に適した設定に変更します。

.. _Redmineを使い始めるための初期設定: https://redmine.jp/tech_note/first-step/admin/

::

   https://redmine.jp/tech_note/first-step/admin/

以下サイトを参考にして、アクセス権限の変更をします

::

   http://redmine.jp/faq/administration/require-auth/

その他、以下設定を行います。本設定は 書籍 `入門 Redmine 第5版`_ を参考にしています。

.. _入門 Redmine 第5版: http://amzn.asia/2MJWV1Z

* ユーザ認証設定

   ログインしていないユーザには情報を見せない設定をします。

   メニュー、管理、設定、認証で以下の項目を変更します。

   * 認証が必要を 「ON」 に
   * ユーザによるアカウント登録を 「無効」 に
   * ユーザによるアカウント削除の許可を 「OFF」 に

* プロジェクト設定

   新たに作成したプロジェクトを「公開」にしない設定をします。

   メニュー、管理、設定、プロジェクトで以下の項目を変更します。

   * デフォルトで新しいプロジェクトは公開にするを 「OFF」に

* メール通知の設定

   Redmine から通知されるメールの本文の Redmine のリンクURLを設定します。

   メニュー、管理、設定、全般で以下の項目を変更します。

   * ホスト名とパスを、「実在するサーバのURL」に

   Redmine から送信されるメールの From のアドレスと本文の振ったを設定します。

   メニュー、管理、設定、メール通知で行います。

   * 送信元メールアドレスを、「実在するメールアドレス」 に
   * メールのフッタを、「デフォルトのものを削除」　に

* 添付ファイルの上限の設定

   メニュー、管理、設定、ファイル 内の 「添付ファイルの上限」を設定します。

* テキスト編集の書式設定

   メニュー、管理、設定、全般 内の テキストの書式を設定します。
   「Textile」 から、「Markdown」 に変更します。

* エクスポートするチケット数の上限設定

   メニュー、設定、チケットランキング内の「添付ファイルサイズの上限」を設定します。

* チケット関連の設定

   * メニュー、設定、チケットトラッキング内の「異なるプロジェクトのチケット間で関連の設定を許可」をチェックします。
   * 「異なるプロジェクトのチケット間の親子関係を許可」に「すべてのプロジェクト」を選択します。

プロジェクトを始める準備
------------------------

プロジェクトを作成する前に各種マスター定義を行います。
メニュー、管理から以下の設定を行います。

ロール
^^^^^^

以下のロールを作成します。

* 管理者 はそのまま残す
* 開発者の名称を担当者に変更
* 報告者は削除する

グループ
^^^^^^^^

以下のグループを作成します。

管理 / 担当

トラッカー
^^^^^^^^^^

既定のトラッカーを削除し、以下のトラッカーを作成します。

* 設備トラッカー
   * IAサーバ
   * UNIXサーバ
   * ストレージ
   * ネットワーク
   * ソフトウェア
   * その他設備
* プロジェクト管理用トラッカー
   * 課題
   * インシデント

チケットとステータス
^^^^^^^^^^^^^^^^^^^^

以下の既定のステータスを削除します。

進行中 / 解決 / フィードバック

以下のステータスを作成します。

* 設備
   * 構築中
   * 運用中
   * 保管
   * 廃棄
* 課題 / インシデント
   * 対応中
   * 調査中
   * 対処待ち
   * 完了待ち

運用中 / 保管 / 廃棄 を、終了したチケットに設定します。

カスタムフィールド
^^^^^^^^^^^^^^^^^^

現状のサーバ管理台帳に合わせてカスタムフィールドを追加します。

.. note::

   カスタムフィールドは既存のシステム運用に合わせて設定してください。
   以下に例を記します。

.. csv-table::
   :header: 名称, 書式, オプション
   :widths: 15, 10, 20

   名称, 書式,
   種別, リスト,
   システム分類, リスト,
   MODEL_IA, リスト,
   MODEL_SPARC, リスト,
   MODEL_POWER, リスト,
   ホスト名, テキスト,
   OS_IA, リスト,
   OS_SPARC, リスト,
   OS_AIX, リスト,
   仮想化インフラ, 真偽値,
   IPアドレス, テキスト,
   監視設定, リスト, Ping / SNMP Trap / Zabbix
   監視設定備考, テキスト,
   保守, リスト,
   シリアル, テキスト,
   発報連絡, 真偽値,
   パスワード, テキスト,
   インベントリー, リンク, リンクURL定義 /redmine/inventory?node=%value%
   インシデント管理, リンク,
   プラットフォーム, リスト, Linux/Windows/Solaris
   OSアカウント, テキスト,
   Zabbixアカウント, テキスト,

.. note::

   * Platform の選択肢に、Linux/Windows/Solaris/VMHost/Etc を入力してくださ('/'は改行にして入力して下さい)
   * 「全プロジェクト向け」をチェックします
   * 各トラッカーのカスタムフィールド定義で必要なカスタムフィールドを選択します

プロジェクトの作成
------------------

プロジェクトメニューから「新しいプロジェクト」をクリックして、
新規プロジェクトを作成します。

* 情報タブ
   * 名称を「構成管理データベース」に
   * トラッカーに使用するトラッカーをチェック
* モジュールタブ
   * 時間管理、文書、ファイル、カレンダー、ガントチャートのチェックを外す
* メンバー
   * 新しいメンバーをクリックして、使用するユーザを登録
* バージョン
   * 新しいバージョンをクリックして、設備増設のプロジェクト名、または期間を追加

ユーザの作成
------------

メニュー、管理、ユーザを選択して、「新しいユーザ」をクリックします。
以下の項目を入力します。

* ログインID
   - ローマ字入力で「{苗字}-{名前の頭文字}」の形式で入力
* 名前 / 苗字 / メールアドレス
   - ユーザ情報を入力
* パスワード
   - 既定のパスワード 入力
   - 「初回ログイン時にパスワード変更を強制」 をチェック
* 言語
   - 「日本語」に
* システム管理者
   - システム管理者の場合、チェック。システム管理者は「管理」画面でプロジェクトやユーザの更新、そのほかRedmine 全体にかかわる設定ができます
* メール通知
   - ウォッチまたは関係している事柄のみ
* タイムゾーン
   - (GMT+09:00) Tokyo に

リファレンス
------------

[Redmine] 前田 剛、2016、「入門 Redmine 第5版」、秀和システム

