Redmine 設定
============

前節でインストールした Redmine を構成管理DBとしてカスタマイズします。

Redmineテーマ変更
-----------------

日本語表示の見易さを重視したテーマの「farend_basic」に変更します

::

   cd ~/redmine/public/themes
   git clone https://github.com/farend/redmine_theme_farend_basic.git
   mv redmine_theme_farend_basic/ farend_basic

Webブラウザから、http://サーバ/redmine にアクセスします。
ユーザ/パスワードに admin/admin を入力して、管理者ユーザとして接続します

上部メニューから、管理、設定、表示、テーマで「farend_basic」に変更

Getconfig プラグインの追加
--------------------------

検査エビデンス用のテーブルをRedmineデータベースに作成し、Redmineリンク
から参照できるようにします。

GitHub からプラグインをダウンロードします。

::

   cd ~/redmine/plugins
   git clone https://github.com/frsw3nr/redmine_getconfig

プラグイン用ライブラリをインストールします。

::

   cd ~/redmine
   bundle install

Redmineデータベースにテールぶろ作成します

::

   bundle exec bin/rake redmine:plugins:migrate

テーブルの文字コードの設定を utf8 から utf8mb4 に変更します。

::

   mysql -u root -p redmine < plugins/redmine_getconfig/docs/db_change_utf8_to_utf8mb4.sql

初期設定
--------

`Redmineを使い始めるための初期設定`_ を参考にして、日本語の利用に適した設定の通り変更します。

.. _Redmineを使い始めるための初期設定: https://redmine.jp/tech_note/first-step/admin/

::

   https://redmine.jp/tech_note/first-step/admin/

以下サイトを参考にして、アクセス権限の変更をします

::

   http://redmine.jp/faq/administration/require-auth/

その他、以下設定を行います。本設定は 書籍 `入門 Redmine 第5版`_ を参考にしています。

.. _入門 Redmine 第5版: http://amzn.asia/2MJWV1Z

* ユーザ認証設定

   ログインしていないユーザには情報を見せない設定をします。

   メニュー、管理、設定、認証で以下の項目を変更します。

   * 認証が必要を 「ON」 に
   * ユーザによるアカウント登録を 「無効」 に
   * ユーザによるアカウント削除の許可を 「OFF」 に

* プロジェクト設定

   新たに策英したプロジェクトを「公開」にしない設定をします。

   メニュー、管理、設定、プロジェクトで以下の項目を変更します。

   * デフォルトで新しいプロジェクトは公開にするを 「OFF」に

* メール通知の設定

   Redmine から通知されるメールの本文の Redmine のリンクURLを設定します。

   メニュー、管理、設定、全般で以下の項目を変更します。

   * ホスト名とパスを、「実在するサーバのURL」に

   Redmine から送信されるメールの From のアドレスと本文の振ったを設定します。

   メニュー、管理、設定、メール通知で行います。

   * 送信元メールアドレスを、「実在するメールアドレス」 に
   * メールのフッタを、「デフォルトのものを削除」　に

* 添付ファイルの上限の設定

   メニュー、管理、設定、ファイル 内の 「添付ファイルの上限」を設定します。

* テキスト編集の書式設定

   メニュー、管理、設定、全般 内の テキストの書式を設定します。
   「Textile」 から、「Markdown」 に変更します。

* エクスポートするチケット数の上限設定

   メニュー、設定、チケットランキング内の「添付ファイルサイズの上限」を設定します。


設定ファイルの編集
------------------

ロケールファイルを編集して、"チケット"を"管理対象"に変更します

::

   cd ~/redmine/config/locales
   cp ja.yml ja.yml.bak
   sed -i -e 's/チケット/管理対象/g' ja.yml

プロジェクトを始める準備
------------------------

プロジェクトを作成する前に各種マスター定義を行います。
メニュー、管理から以下の設定を行います。

グループ
^^^^^^^^

以下のグループを作成します。

インフラ運用 / システム運用 / その他

ロール
^^^^^^

以下のロールを作成します。

管理者 / インフラ運用者 / システム運用者

トラッカー
^^^^^^^^^^

既定のトラッカーを削除し、以下のトラッカーを作成します。

Linux / Windows / Solaris / ESXi / ストレージ / 監視 / その他

チケットとステータス
^^^^^^^^^^^^^^^^^^^^

既定のステータスを削除し、以下のステータスを作成します。

構築前 / 構築中 / 引渡し前 / 使用中 / 保管 / 廃棄

使用中 / 保管 / 廃棄 を、終了したチケットに設定します。

ワークフロー
^^^^^^^^^^^^

(設定確認中)

カスタムフィールド
^^^^^^^^^^^^^^^^^^

現状のサーバ管理台帳に合わせてカスタムフィールドを追加します。

:doc:`../../02_StandaloneTest/02_Usage/03_CSVImport` を使用する場合は、
チケット(管理対象)に以下のフィールドを登録してください。
サーバ構成情報の検査で Redmine チケットの CSV ダウンロード機能を用いて、
検査対象をダウンロードし、
getconfig オプション(-i issues.csv)で CSV を指定して検査を行います。

.. csv-table::
   :header: 書式, 名称, オプション
   :widths: 10, 15, 20

   テキスト, サーバ名, 必須
   テキスト, IPアドレス,
   リスト, Platform, 以下、注釈の選択肢を入力
   テキスト, OSアカウントID,
   テキスト, vCenterアカウントID,
   テキスト, VMエイリアス名,
   テキスト, 検査ID,
   テキスト, 比較対象サーバ名,
   整数, CPU数,
   整数, メモリ量,
   テキスト, ESXi名,
   テキスト, HDD,

.. note::

   * Platform の選択肢に、Linux/Windows/Solaris/VMHost/Etc を入力してくださ('/'は改行にして入力して下さい)
   * 「全プロジェクト向け」をチェックします
   * トラッカーの「すべてにチェックをつける」を選択します

プロジェクトの作成
------------------

プロジェクトメニューから「新しいプロジェクト」をクリックして、
新規プロジェクトを作成します。

* 情報タブ
   * 名称を「構成管理データベース」に
   * 説明に 実際の用途 を記述
   * トラッカーに使用するトラッカーをチェック
   * カスタムフィールドに使用するカスタムフィールドをチェック
* モジュールタブ
   * ガントチャートのチェックを外す
* メンバー
   * 新しいメンバーをクリックして、使用するユーザを登録
* バージョン
   * 新しいバージョンをクリックして、設備増設のプロジェクト名、または期間を追加

ユーザの作成
------------

メニュー、管理、ユーザを選択して、「新しいユーザ」をクリックします。
以下の項目を入力します。

* ログインID
   - ローマ字入力で「{苗字}-{名前の頭文字}」の形式で入力。例えば、古澤 実の場合、furusawa-m とします
* 名前 / 苗字 / メールアドレス
   - ユーザ情報を入力
* パスワード
   - 既定のパスワード 入力
   - 「初回ログイン時にパスワード変更を強制」 をチェック
* 言語
   - 「日本語」に
* システム管理者
   - システム管理者の場合、チェック。システム管理者は「管理」画面でプロジェクトやユーザの更新、そのほかRedmine 全体にかかわる設定ができます
* メール通知
   - ウォッチまたは関係している事柄のみ
* タイムゾーン
   - (GMT+09:00) Tokyo に

引用・参考文献
--------------

[Redmine] 前田 剛、2016、「入門 Redmine 第5版」、秀和システム

