検査結果のエクスポート機能
==========================

システム概要
------------

検査結果のチェックについてチェックルールを使用せずに目視で設計値との比較をする
ケースにおいて、
検査結果が複数シートにまたがるとチェック作業が非効率なものとなり、
チェックミスを犯しやすい問題が発生します。
対策として、複数の検査結果シートを1つにまとめるオプション機能を使用します。
そのシステム構成は以下の通りです。

   .. figure:: ../image/export.png
      :align: center
      :alt: System Overview
      :width: 640px

getconfig のエクスポートオプション(-x)用いて複数の検査結果を CSV ファイルに
エクスポートします。
エクスポートしたデータを予め設計値を設定したチェック用エクセルの比較データ用
シートに貼り付けます。
エクセルのLOOKUP関数を用いて、貼り付けたデータを参照して、設計値との比較をします。

.. note::

   エクスポートする結果はチェックシートサマリのみで、デバイスの詳細シートの
   エクスポートはできません。

使用方法
--------

予めgetconfig コマンドで検査対象の検査結果シートを作成します。
以下のコマンドで検査結果を指定して、CSVエクスポートを行います。

::

   getconfig -x チェックシート○○○.xlsx,チェックシート○○○.xlsx,...

CSV エクスポートファイルは config.groovy 内に記述した以下パスの下に保存します。

::

   evidence.csv_export='./build/export/compare\_<date>.csv'

CSV エクスポートデータは下表サンプルの通りで、以下の列から構成します。

* エクセルLOOKUP用のKey
* ServerName
* Domain
* TestItem
*  Value

エクセルからCSVファイルを開いて読み込みをします。ここでは、シート名を「比較データ」とします。

**シート「比較データ」**

+------------------------+------------+---------+----------+-------------------------------------------------+
| Key                    | ServerName | Domain  | TestItem | Value                                           |
+========================+============+=========+==========+=================================================+
| WIN2016:Windows:cpu    | WIN2016    | Windows | cpu      | Intel(R) Xeon(R) CPU E5-2609 v3 @ 1.90GHz 2 CPU |
+------------------------+------------+---------+----------+-------------------------------------------------+
| WIN2016:Windows:memory | WIN2016    | Windows | memory   | 2096692                                         |
+------------------------+------------+---------+----------+-------------------------------------------------+
| WIN2016:Windows:system | WIN2016    | Windows | system   | WORKGROUP\\WIN2016                              |
+------------------------+------------+---------+----------+-------------------------------------------------+
| ...                    |            |         |          |                                                 |
+------------------------+------------+---------+----------+-------------------------------------------------+

比較用シートのサンプルは以下の通りです。

**シート「Windows引渡し項目」**

+-----+------------+----------+---------------------------+--------------------------------------------------+
|     | 列1        | 列2      | 列3                       | 列4                                              |
+=====+============+==========+===========================+==================================================+
| 行1 |            | 検査対象 | WIN2016                   |                                                  |
+-----+------------+----------+---------------------------+--------------------------------------------------+
| 行2 | 検査ID     | ドメイン | 設定値                    | 収集値                                           |
+-----+------------+----------+---------------------------+--------------------------------------------------+
| 行3 | cpu        | Windows  | Xeon E5-2609 1.9GHz 2CPU  | Intel(R) Xeon(R) CPU E5-2609 v3 @ 1.90GHz 2 CPU  |
+-----+------------+----------+---------------------------+--------------------------------------------------+
| 行4 | memory     | Windows  | 2GB                       | 2096692                                          |
+-----+------------+----------+---------------------------+--------------------------------------------------+
| 行5 | system     | Windows  | WORKGROUP\\WIN2016        | WORKGROUP\\WIN2016                               |
+-----+------------+----------+---------------------------+--------------------------------------------------+
| 行6 | os         | Windows  | Windows Server 2016 64bit | Microsoft Windows Server 2016 Standard 64 ビット |
+-----+------------+----------+---------------------------+--------------------------------------------------+
| 行7 | filesystem | Windows  | Cドライブ(100GB)          | [C::99]                                          |
+-----+------------+----------+---------------------------+--------------------------------------------------+
| ... |            |          |                           |                                                  |
+-----+------------+----------+---------------------------+--------------------------------------------------+


行3以降の、列1～列3はあらかじめシートに記載した設計値となり、以下項目の値を作成します。

* 列1 ：検査シートの検査ID
* 列2 ：検査シートのドメイン名
* 列3 ：本検査項目に関する設定値

行1:列3 の項目は検査対象のサーバ名を記述します。

列4 は検査結果列で、LOOKUP関数を用いて、以下の計算式でシート「比較データ」の値のルックアップをした値となります。

::

   =IFERROR(VLOOKUP(D$6&":"&$B7&":"&$A7,比較データ!$A:$E,5,FALSE),"")

本シートの設定値と収集した値でチェックを行います。
