過去に収集したインベントリとの比較
==================================

過去に収集したインベントリとの比較手順を記します。
サーバ移行作業などで、移行元の既存サーバと、移行先の新規サーバとのインベントリを比較したい
場合に本手順を利用します。

.. note::

   * 前提条件

      過去に古い検査対象のインベントリ収集を実行済みで、新規検査対象のインベントリと
      比較をする場合に本手順が有効です

手順
----

手順の概要は以下の通りです。

1. 新規検査対象を、通常のインベントリ収集と同様に収集を実行します
2. 過去の検査結果の実行ログを src 下にコピーします
3. 検査シートに比較対象の過去の検査対象サーバの情報を記入します
4. ドライランモードで検査を再度実行すると、比較結果がレポートされます

ここでは、Linux サーバのインベントリ比較を例として、以下の環境での実行手順を記します。

* 新規インベントリ収集(移行先インベントリ)
   * プロジェクト名: poting1
   * 新規サーバ名: newserver1
* 既存インベントリ収集(移行元インベントリ)
   * プロジェクト名: old1
   * 既存サーバ名: oldserver1

新規検査対象を、通常の検査で実行
--------------------------------

poting1 で、プロジェクトを作成をします。

::

   getconfig -g poting1

通常の手順で、検査シートに新規サーバの接続情報を設定します。

::

   cd poting1
   # Excelを開いて検査対象に newserver1 を入力
   .\サーバチェックシート.xslx 
   # 設定ファイルを開いて newserver1 のアカウントを入力
   notepad++ .\config\config.groovy

コマンドを実行します。

::

   getconfig -c config\config.groovy

build下に作成された Excel 検査結果ファイルを確認し、Excel を開いて結果を確認ます。

::

   dir build

過去の検査結果の実行ログのコピー
--------------------------------

過去に実行したインベントリ収集プロジェクトの src ディレクトリを上記で作成したプロジェクト下に
まとめてコピーします。

::

   Copy-Item ..\old1\src .\src -Recurse

.. note::

   上記コマンドは、同じディレクトリ階層下に新旧両インベントリ収集プロジェクトがある前提で実行しています。

検査シートに比較対象の過去の検査対象サーバを記入
------------------------------------------------

新規プロジェクトの検査対象シートを編集します。

1. 「検査対象」シートに行を追加し、既存サーバの設定を入力します。入力は「検査ドメイン」列、「対象サーバ」列のみで構いません
2. 新規サーバの設定行の「比較対象」列に上記で入力した既存サーバ名を入力します

ドライランモードで再度実行
--------------------------

検査シート編集後、ドライランモードで再度コマンドを実行します。

::

   getconfig -d -c config\config.groovy

build下の実行結果を確認します。

::

   dir build

既存サーバとの比較結果の情報が追加された実行結果が保存されます。

